<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz Board</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #eaf6ff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }

    .quiz-board {
      max-width: 1000px;
      width: 95%;
      margin: 20px auto;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      padding: 25px;
      animation: fadeIn 0.6s ease-in-out;
    }

    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .quiz-header h2 {
      font-size: 1.6rem;
      color: #2b6777;
    }

    .stats {
      font-size: 1rem;
      color: #555;
    }

    .question {
      font-size: 1.4rem;
      font-weight: bold;
      margin-bottom: 20px;
      color: #333;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .options button {
      padding: 15px;
      border-radius: 12px;
      border: none;
      background: #e0f7fa;
      font-size: 1.1rem;
      text-align: left;
      transition: 0.3s;
      cursor: pointer;
    }

    .options button:hover {
      background: #4dd0e1;
      color: #fff;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.6);
    }

    .modal.hidden { display: none; }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      max-width: 500px;
      width: 90%;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  
<div id="quiz-board" class="quiz-board">
  <header class="quiz-header">
    <h2 id="quiz-title">English Studies Quiz</h2>
    <div class="stats">
      <span id="score">Score: 0</span>
      <span id="timer">Time: 30s</span>
    </div>
  </header>

  <main class="quiz-body">
    <div id="question" class="question">Loading...</div>
    <div id="options" class="options"></div>
  </main>
</div>

<!-- Level modal -->
<div id="level-modal" class="modal hidden">
  <div class="modal-content">
    <h3 id="level-message">ðŸŽ‰ Congratulations!</h3>
    <p id="level-requirement"></p>
    <button id="next-level-btn">Proceed to Next Level ðŸš€</button>
    <button id="exit-btn">Exit</button>
  </div>
</div>

<!-- Sounds -->
<audio id="sound-correct" src="sounds/correct.mp3"></audio>
<audio id="sound-wrong" src="sounds/wrong.mp3"></audio>
<audio id="sound-flip" src="sounds/flip.mp3"></audio>

<script>
let currentLevel = 1;
let currentQuestionIndex = 0;
let score = 0;
let questions = [];

const levelConfig = {
  1: { total: 50, pass: 45 },
  2: { total: 60, pass: 55 },
  3: { total: 80, pass: 75 }
};

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function getSubjectFromURL(){
  const params = new URLSearchParams(window.location.search);
  return params.get("subject") || "English";
}

async function loadQuestions(subject, level){
  const res = await fetch("questions.json");
  const data = await res.json();
  if(data[subject] && data[subject][`level${level}`]){
    questions = shuffle([...data[subject][`level${level}`]]);
    currentQuestionIndex = 0;
    score = 0;
    document.getElementById("quiz-title").innerText = `${subject} Quiz - Level ${level}`;
    showQuestion();
  }else{
    document.getElementById("quiz-board").innerHTML=`<h2>No questions found for ${subject} - Level ${level}</h2>`;
  }
}

function showQuestion(){
  if(currentQuestionIndex >= questions.length){
    checkLevelPass();
    return;
  }
  const q = questions[currentQuestionIndex];
  document.getElementById("question").innerText = q.question;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  shuffle([...q.options]).forEach(opt=>{
    const btn = document.createElement("button");
    btn.innerText = opt;
    btn.onclick = ()=>checkAnswer(opt, q.answer);
    optionsDiv.appendChild(btn);
  });
  document.getElementById("sound-flip").play();
}

function checkAnswer(selected, correct){
  if(selected === correct){
    score++;
    document.getElementById("score").innerText = `Score: ${score}`;
    document.getElementById("sound-correct").play();
  }else{
    document.getElementById("sound-wrong").play();
  }
  currentQuestionIndex++;
  setTimeout(showQuestion, 700);
}

function checkLevelPass(){
  const passScore = levelConfig[currentLevel].pass;
  document.getElementById("level-modal").classList.remove("hidden");

  if(score >= passScore){
    document.getElementById("level-message").innerText = `ðŸŽ‰ You passed Level ${currentLevel}!`;
    if(currentLevel < 3){
      document.getElementById("level-requirement").innerText = `Do you want to proceed to Level ${currentLevel+1}?`;
      document.getElementById("next-level-btn").onclick = ()=>{
        currentLevel++;
        toggleModal(false);
        loadQuestions(getSubjectFromURL(), currentLevel);
      };
    }else{
      document.getElementById("level-requirement").innerText = "ðŸ‘‘ Congratulations! You completed all levels!";
      document.getElementById("next-level-btn").style.display = "none";
    }
  }else{
    document.getElementById("level-message").innerText = "ðŸ˜¢ You did not meet the required score.";
    document.getElementById("level-requirement").innerText = "Try again to unlock the next level.";
    document.getElementById("next-level-btn").innerText = "Retry Level";
    document.getElementById("next-level-btn").onclick = ()=>{
      toggleModal(false);
      loadQuestions(getSubjectFromURL(), currentLevel);
    };
  }

  document.getElementById("exit-btn").onclick = ()=>{ window.location.href="subjects.html"; };
}

function toggleModal(show){
  document.getElementById("level-modal").classList.toggle("hidden", !show);
}

// Start Quiz
const subject = getSubjectFromURL();
loadQuestions(subject, currentLevel);
</script>
</body>
</html>

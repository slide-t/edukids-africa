<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subjects - EduKids Africa</title>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- Fixed search container -->
  <div class="fixed w-full bg-white z-50 shadow p-4 mb-60">
    <input id="searchInput" type="text" placeholder="" 
           class="w-full max-w-2xl mx-auto px-4 py-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500"/>
    <!-- Tooltip -->
    <div id="searchTooltip" class="hidden absolute bg-yellow-300 text-gray-900 px-3 py-2 rounded shadow mt-2 text-sm">Please type a subject before searching</div>
  </div>

  <div class="max-w-4xl mx-auto mt-40 px-4">
    <h1 class="text-3xl text-center font-bold text-gray-900 mb-8">Subjects Offered</h1>
    <div id="subject-list" class="space-y-4"></div>
  </div>

<script>
const subjectList = document.getElementById("subject-list");
const searchInput = document.getElementById("searchInput");
const tooltip = document.getElementById("searchTooltip");

let subjects = {};

/* Typing placeholder */
const placeholderText = "search by subject here...";
let i = 0;
function typePlaceholder() {
  if(i <= placeholderText.length){
    searchInput.setAttribute("placeholder", placeholderText.slice(0,i));
    i++;
    setTimeout(typePlaceholder,120);
  }
}
typePlaceholder();

/* Load subjects from JSON */
async function loadSubjects() {
  try {
    const res = await fetch('subjects.json');
    subjects = await res.json();
    renderSubjects();
  } catch(err){
    console.error("Failed to load subjects.json", err);
    subjectList.innerHTML = "<p class='text-red-600 text-center'>Failed to load subjects.</p>";
  }
}

/* Render subjects */
function renderSubjects(filter="") {
  subjectList.innerHTML = "";
  Object.keys(subjects).forEach(category => {
    const groupDiv = document.createElement("div");
    groupDiv.className = "bg-white rounded-xl shadow overflow-hidden";

    // Heading
    const heading = document.createElement("h2");
    heading.className = "flex justify-between items-center cursor-pointer text-lg font-semibold text-gray-900 px-4 py-3 border-b border-gray-300";
    heading.innerHTML = `${category} <i class="fas fa-chevron-down transition-transform duration-300"></i>`;

    // Subject list
    const listDiv = document.createElement("div");
    listDiv.className = "max-h-0 overflow-hidden transition-all duration-500 pb-4 space-y-2 px-4";

    subjects[category]
      .filter(sub => sub.toLowerCase().includes(filter.toLowerCase()))
      .forEach(sub => {
        const item = document.createElement("a");
        const fileName = sub.toLowerCase().replace(/\s+/g,'-');
        item.className = "block px-4 py-2 rounded-lg bg-gray-100 hover:bg-yellow-400 hover:text-gray-900 transition";
        item.href = `quiz.html?subject=${encodeURIComponent(fileName)}`;
        item.textContent = sub;
        listDiv.appendChild(item);
      });

    // Heading toggle
    heading.addEventListener("click", ()=>{
      listDiv.classList.toggle("max-h-0");
      listDiv.classList.toggle("max-h-96");
      heading.querySelector("i").classList.toggle("rotate-180");
    });

    groupDiv.appendChild(heading);
    groupDiv.appendChild(listDiv);
    subjectList.appendChild(groupDiv);
  });
}

/* Search input */
searchInput.addEventListener("input", e=>{
  const value = e.target.value.trim();
  renderSubjects(value);
  if(value!==""){
    // auto expand matching categories
    document.querySelectorAll("#subject-list .max-h-0").forEach(list => list.classList.replace("max-h-0","max-h-96"));
  }
});

/* Tooltip for empty Enter */
searchInput.addEventListener("keydown", e=>{
  if(e.key==="Enter" && e.target.value.trim()===""){
    tooltip.classList.remove("hidden");
    tooltip.style.position="absolute";
    tooltip.style.top=(searchInput.offsetTop+searchInput.offsetHeight+5)+"px";
    tooltip.style.left=searchInput.offsetLeft+"px";
    setTimeout(()=>tooltip.classList.add("hidden"),10000);
  }
});

loadSubjects();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Books</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-purple-950 text-white min-h-screen">

  <!-- Header -->
  <header class="p-6 text-center bg-purple-900 shadow-lg">
    <h1 class="text-3xl font-bold">Our Book Collection</h1>
    <p class="text-purple-300 mt-2">Explore, Preview & Order Your Favorite Books</p>
  </header>

  <!-- Search & Filters -->
  <section class="p-6">
    <div class="flex flex-col md:flex-row gap-4">
      <input 
        id="searchBar" 
        type="text" 
        placeholder="Search by title..." 
        class="p-2 rounded-md border border-purple-700 text-black w-full md:w-1/3"
      />
      <select id="filterAuthor" class="p-2 rounded-md border border-purple-700 text-black w-full md:w-1/3">
        <option value="">Filter by Author</option>
      </select>
      <select id="filterSubject" class="p-2 rounded-md border border-purple-700 text-black w-full md:w-1/3">
        <option value="">Filter by Subject</option>
      </select>
    </div>
  </section>

  <!-- Books Grid -->
  <main class="p-6">
    <div id="books-container" class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
  </main>

  <!-- Modal for Description -->
  <div id="bookModal" class="fixed inset-0 hidden bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-purple-900 p-6 rounded-lg shadow-lg max-w-lg w-full relative">
      <button onclick="closeModal()" class="absolute top-2 right-2 text-white text-xl">✖</button>
      <h2 id="modalTitle" class="text-2xl font-bold mb-2"></h2>
      <p id="modalAuthor" class="mb-2 text-purple-300"></p>
      <p id="modalDescription" class="text-purple-100"></p>
    </div>
  </div>

  <script>
    let booksData = [];

    // Load JSON
    async function loadBooks() {
      const response = await fetch("books.json");
      booksData = await response.json();
      displayBooks(booksData);
      populateFilters();
    }

    // Display Books
    function displayBooks(books) {
      const container = document.getElementById("books-container");
      container.innerHTML = "";
      books.forEach(book => {
        const card = document.createElement("div");
        card.className = "bg-purple-800 rounded-lg shadow-lg overflow-hidden hover:scale-105 transition-transform";

        card.innerHTML = `
          <img src="${book.image}" alt="${book.title}" class="w-full h-40 object-cover">
          <div class="p-4">
            <h3 class="text-lg font-bold">${book.title}</h3>
            <p class="text-sm text-purple-300">by ${book.author}</p>
            <button onclick="openModal('${book.title}','${book.author}','${book.description}')" 
              class="mt-2 text-sm text-yellow-400 underline">Read More</button>
            <div class="mt-4">
              <button onclick="toggleCart(this)" class="bg-yellow-500 text-black px-3 py-1 rounded-md w-full">
                Add to Cart
              </button>
              <a href="your-pwa-link" 
                class="hidden mt-2 block bg-green-500 text-black px-3 py-1 rounded-md text-center">
                Buy Now
              </a>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // Toggle Add to Cart → Buy Now
    function toggleCart(button) {
      const buyNowBtn = button.nextElementSibling;
      buyNowBtn.classList.toggle("hidden");
    }

    // Open Modal
    function openModal(title, author, description) {
      document.getElementById("modalTitle").textContent = title;
      document.getElementById("modalAuthor").textContent = "by " + author;
      document.getElementById("modalDescription").textContent = description;
      document.getElementById("bookModal").classList.remove("hidden");
    }

    // Close Modal
    function closeModal() {
      document.getElementById("bookModal").classList.add("hidden");
    }

    // Filters
    function populateFilters() {
      const authors = [...new Set(booksData.map(book => book.author))];
      const subjects = [...new Set(booksData.map(book => book.subject))];

      const authorFilter = document.getElementById("filterAuthor");
      const subjectFilter = document.getElementById("filterSubject");

      authors.forEach(author => {
        const option = document.createElement("option");
        option.value = author;
        option.textContent = author;
        authorFilter.appendChild(option);
      });

      subjects.forEach(subject => {
        const option = document.createElement("option");
        option.value = subject;
        option.textContent = subject;
        subjectFilter.appendChild(option);
      });
    }

    // Search + Filter Functionality
    document.getElementById("searchBar").addEventListener("input", filterBooks);
    document.getElementById("filterAuthor").addEventListener("change", filterBooks);
    document.getElementById("filterSubject").addEventListener("change", filterBooks);

    function filterBooks() {
      const search = document.getElementById("searchBar").value.toLowerCase();
      const author = document.getElementById("filterAuthor").value;
      const subject = document.getElementById("filterSubject").value;

      const filtered = booksData.filter(book => {
        return (
          book.title.toLowerCase().includes(search) &&
          (author === "" || book.author === author) &&
          (subject === "" || book.subject === subject)
        );
      });

      displayBooks(filtered);
    }

    loadBooks();
  </script>
</body>
</html>
